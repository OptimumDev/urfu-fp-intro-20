# bookmovie

bookmovie — web приложение для бронирования билетов в кино. Некоторая часть методов, описанных ниже, уже реализована и в качестве задания вам необходимо реализовать недостающие методы для покупки и отмены заказов.

# Сценарий использования

Пользователь запрашивает список доступных сеансов `GET api/movie_sessions`.

Выбрав сеанс, запрашивает список доступных место `GET api/movie_sessions/<session_id>/seats`.

Выбрав желаемое место, бронирует его `GET api/movie_sessions/<session_id>/preliminary_booking/<seat_id>`, получив номер брони `<booking_id>`.

Предварительное бронирование предоставляет клиенту 10 минут на ввод данных для оплаты, чтобы совершить покупку `GET api/checkout/<booking_id>`.

Если прошло 10 минут с момента создания бронирования и пользователь не успел оплатить место, то необходимо снять бронирование.

Если пользователь решил вернуть билет, то он может воспользоваться услугой возврата `GET api/refund/<booking_id>`.

# Список методов

- `GET api/movie_sessions` — возвращает список доступных сеансов
- `GET api/movie_sessions/<session_id>/seats` — возвращает список доступных мест
- `GET api/movie_sessions/<session_id>/preliminary_booking/<seat_id>` — создаёт предварительное бронирование выбранного места, возвращая `<booking_id>`
- [Not implemented] `GET api/checkout/<booking_id>`— оплата бронирования
- [Not implemented] `GET api/refund/<booking_id>` — отмена бронирования

Как вы видите, пока везде используется только один http-метод — `GET`. Мы решили оставить так, чтобы вы могли выполнить любой запрос даже из адресной строки в браузере. Однако, уместное использование других методов приветствуется.

# Что делать

Вам необходимо описать API методы, создав в `src/API/` нужные модули, опираясь на уже существующие. Точно также с хэндлерами и методами для работы с базой данных в `src/Handlers.hs` и `src/DB/` соответственно.

* Доп. задачка #1
Сделать подсчёт количества запросов. Попробуйте сделать это с помощью StateT, IORef или TVar.

* Доп. запача #2
Сделать поддержку бронирования нескольких мест.

# Перед запуском

В качестве базы данных в приложении используется [sqlite](https://www.sqlite.org/index.html). Необходимо скачать утилиты для работы с ней на странице [download](https://www.sqlite.org/download.html).<br/>
С помощью утилиты `sqlite3` в корне проекта выпоните скрипт `seeds.sql` для создания таблиц и добавления начальных данных в bookmovie.db:
```
sqlite3.exe bookmovie.db < seeds.sql
```
Так же вы можете добавить выполнение команд по созданию таблиц в код старта приложения.

# Запуск

Для старта приложения воспользуйтесь уже знакомой командой `cabal new-run`:
```
cabal new-run bookmovie
```
После этого вы можете отправлять запросы на `localhost:3000` из любого http-клиента:
```
GET http://localhost:3000/api/movie_sessions


[{"start_time":"2020-05-11T19:11:23Z","title":"John Wick 3","sessionId":1,"duration":120}]
```

# Полезные ссылки

- Документация `sqlite-simple`: http://hackage.haskell.org/package/sqlite-simple
- Примеры по работе с `sqlite-simple`: http://www.mchaver.com/posts/2017-06-28-sqlite-simple.html
- Tutorial по `servant`: https://docs.servant.dev/en/stable/tutorial/
